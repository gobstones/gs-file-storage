<link rel="import" href="gs-file-storage.html">
<link rel="import" href="gs-submit-file.html">
<link rel="import" href="gs-file.html">
<link rel="import" href="../../../gs-file-explorer/dist/components/gs-file-explorer.html">
<dom-module id="gs-file-storage-demo">
  <template>
    <style>
      :host {
        font-family: 'roboto', sans-serif;
        font-weight: bold;
        --form-width: 300px;
        --form-height: 320px;
      }

      #demo-header {
        margin: 0 auto;
        background-color: #E70126;
        display: table;
        font-size: 4vh;
        border-radius: 5px;
        width: 70%;
        text-align: center;
        margin-top: 5vh;
        height: 10vh;
        box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);
      }

      .submitFileForm {
        display: block;
        margin-top: 4vh;
        width: 300px;
      }

      .column {
        margin: 0 auto;
        display: table;
      }

      .demoToolTip {
        color: white;
        box-sizing: border-box;
        background: #d30123;
        border-radius: 1px;
        box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);
        margin: 0 auto;
        display: block;
        padding: 20px;
        margin-top: 4vh;
        width: 90%;
        font-size: 132%;
        font-weight: bold;
        margin-left: 5%;
        margin-right: 5%;
        word-wrap: break-word;
        display: inline-block;
      }

      .line-row {
        width: 100%;
        float: left;
      }

      #fileExplorerLabel {
        color: white;
        box-sizing: border-box;
        background: #d30123;
        border-radius: 1px;
        box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);
        margin: 0 auto;
        display: block;
        padding: 4%;
        padding-left: 12%;
        padding-right: 9%;
        height: 80px;
        width: 300px;
        font-size: 135%;
        line-height: 150%;
        margin-top: 4vh;
      }

      #file-explorer {
        color: white;
        box-sizing: border-box;
        background: #d30123;
        border-radius: 1px;
        box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);
        margin: 0 auto;
        display: block;
        width: 300px;
        height: 300px;
        padding: 20px;
        padding-left: 30px;
        font-size: 135%;
        margin-bottom: 4vh;
        color: black;
        overflow: auto;
        border-style: solid;
        border-width: 10px;
        background: #676767;
      }

      #openedFileForm ::content #nameField {
        pointer-events: none;
      }

      /*  SECTIONS  */
      .section {
        clear: both;
        padding: 0px;
        margin: 0px;
      }

      /*  COLUMN SETUP  */
      .col {
        display: block;
        float: left;
        margin: 1% 0 1% 0;
      }

      .col:first-child {
        margin-left: 0;
      }

      /*  GROUPING  */
      .group:before,
      .group:after {
        content: "";
        display: table;
      }

      .group:after {
        clear: both;
      }

      .group {
        zoom: 1;
        /* For IE 6/7 */
      }

      /*  GRID OF THREE  */
      .span_3_of_3 {
        width: 33.33333333%;
      }

      .span_2_of_3 {
        width: 33.33333333%;
      }

      .span_1_of_3 {
        width: 33.33333333%;
      }

      @media only screen and (max-width: 600px) {
        .col {
          margin: 1% 0 1% 0%;
        }

        .span_3_of_3, .span_2_of_3, .span_1_of_3 {
          width: 100%;
        }
      }

      /*# sourceMappingURL=style.css.map */

    </style>

    <p id="demo-header">An example of <br> <code>&lt;gs-file-storage&gt;</code>:</p>

    <div class="section group">

        <div class="col span_1_of_3">
        <h1 id="fileExplorerLabel" > File Explorer</h1>
          <gs-file-explorer id="file-explorer" files="{{files}}"> 
          </gs-file-explorer> 
        </div>

        <div class="col span_2_of_3">
          <div class="demoToolTip" >
            <li>Create files and see them into left file-explorer.</li>
            <br>
            <li>Also refresh page and see last file content steel there.</li>
            <br>
            <li>Create a variable and initialize gs-file-system like
            var this.storage = GsFileStorage() to use it.</li>
            <br>
            <li>gs file system is located in window.GS.GSFILESTORAGE and works like a singleton</li>
            <br>
            <li>gs-file-system let you save gs-files 
                when create a gs-file, create a new GSFile("name") and then gs-file.saveIt() an
                this save it into localStorage
                On save trigger event change in file and if file is new gs-file-system
                trigger listchange event.</li>
          </div>

        </div >

        <div class="col span_3_of_3" >
          
          <gs-submit-file
            label="Create files or rewrite existins files content."
            button-name="Save" 
            id="submit"
            class="submitFileForm">
          </gs-submit-file>
        
        </div>


    </div>

          
    <div class="section group">
      <div class="col span_1_of_3">
          <gs-submit-file
            label="Open files and edit content."
            button-name="Save" 
            id="openedFileForm"
            class="submitFileForm"
            text-field="{{fileDemoText}}"
            name-field="{{fileDemoName}}"
            name-field="">
          </gs-submit-file>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'gs-file-storage-demo',
      properties: {
        files: {
          type: [],
          value: []
        },
        fileDemoName: {
          type: String
        },
        fileDemoText: {
          type: String
        }
      },
      listeners: {
        'openFile': 'openFile',
        'removeFile': 'removeFile'
      },
      ready: function() {
        this.storage = GsFileStorage();
        this.makeFilesForFileExplorer(this.storage.getAllFilesName());
        this.storage.addEventListener('listchange', (function(_this) {
          return function(event) {
            return _this.makeFilesForFileExplorer(_this.storage.getAllFilesName());
          };
        })(this));
        this.listen(this.$.submit, 'submitFile', 'saveFile');
        return this.listen(this.$.openedFileForm, 'submitFile', 'saveOpenedFile');
      },
      saveFile: function(polymerEvent) {
        var eventFile, fileToStorage;
        eventFile = polymerEvent.detail.file;
        fileToStorage = this.storage.getFile(eventFile.name);
        return fileToStorage.save(eventFile.content, this);
      },
      saveOpenedFile: function(polymerEvent) {
        var eventFile;
        eventFile = polymerEvent.detail.file;
        if (this.fileDemo.getName() === eventFile.name) {
          return this.fileDemo.save(eventFile.content, this);
        }
      },
      makeFilesForFileExplorer: function(filesNamesList) {
        var fName, filesNames, _i, _len, _results;
        filesNames = filesNamesList;
        this.files = [];
        _results = [];
        for (_i = 0, _len = filesNames.length; _i < _len; _i++) {
          fName = filesNames[_i];
          _results.push(this.push('files', {
            name: fName,
            content: ""
          }));
        }
        return _results;
      },
      openFile: function(polymerEvent) {
        var fileName;
        fileName = polymerEvent.detail.file.name;
        this.fileDemo = this.storage.getFile(fileName);
        this.fileDemoName = this.fileDemo.getName();
        this.fileDemoText = this.fileDemo.getContent();
        return this.fileDemo.addEventListener('change', (function(_this) {
          return function(event) {
            var newFile;
            console.log("se tiro el evento change");
            if (event.host !== _this) {
              console.log("Entro en el if");
              newFile = event.target;
              return _this.fileDemoText = newFile.getContent();
            }
          };
        })(this));
      },
      removeFile: function(polymerEvent) {
        var fileName;
        fileName = polymerEvent.detail.file.name;
        return this.storage.removeFile(fileName);
      }
    });

  </script>
</dom-module>